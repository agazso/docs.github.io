<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><title>Tutorial - Swarm Bee Documentation</title><meta name=viewport content="width=device-width,initial-scale=1"><link rel=icon href=../favicon.png><link rel=stylesheet href=../css/style.min.aad43d4ecb69a264f2539b89d7f779d5f3cdff22e7585fe5fc3c77272f1c2696.css></head><body class="page page-default-single"><div id=main-menu-mobile class=main-menu-mobile><ul></ul></div><div class=wrapper><div class=header><div class=container><div class=logo><a href=../><img alt=Logo src=../swarm.png></a></div><div class=logo-mobile><a href=../><img alt=Logo src=../swarm.png></a></div><div id=main-menu class=main-menu><ul></ul></div><button id=toggle-main-menu-mobile class="hamburger hamburger--slider" type=button>
<span class=hamburger-box><span class=hamburger-inner></span></span></button></div></div><div class="container pt-2 pt-md-6 pb-3 pb-md-6"><div class=row><div class="col-12 col-md-3 mb-3"><div class=sidebar><div class=docs-menu><h4>Bee docs</h4><ul><li><a href=../bee-docs/introduction.html>Introduction</a></li><li><a href=../bee-docs/installation.html>Installation</a></li><li><a href=../bee-docs/start.html>Starting your node</a></li><li class=active><a href=../bee-docs/tutorial.html>Tutorial</a></li><li><a href=../bee-docs/development.html>Development</a></li><li><a href=../bee-docs/API-reference.html>API and debug API</a></li><li><a href=../bee-docs/architecture.html>Architecture</a></li></ul></div></div></div><div class="col-12 col-md-9"><h1 class=title>Tutorial</h1><div class=content><p>In this section, you will find several tutorials on how to run a Bee node and interact with it. These tutorials are meant as a help to get you started. In this section, no new information <em>specific</em> to Bee is given; we merely combine information from the sections <a href=../bee-docs/installation.html>Installation</a>, <a href=../bee-docs/start.html>Starting your node</a> and <a href=../bee-docs/API-reference.html>API reference</a> with some general development practices and knowledge and repackage this information in a more narrative form.</p><h1 id=upload-and-download-a-file>Upload and download a file</h1><p><a href=../bee-docs/installation.html>Download and install</a> a Bee node, and <a href=../bee-docs/start.html>start</a> it with the default configuration (<code>bee start</code>). We will use the <a href=../bee-docs/API-reference.html>API</a> interface for uploading and downloading.</p><p>There are several ways to interact with the API to upload and download a file. In this tutorial, we will show you how to do it, using the command-line and via your browser.</p><h2 id=upload-via-command-line>Upload via command-line</h2><p>A file can be uploaded by making an HTTP POST request to the <code>files</code> endpoint. We can use <code>curl</code> to do this, like this one:</p><div class=highlight><pre class=chroma><code class=language-sh data-lang=sh>curl -F <span class=nv>file</span><span class=o>=</span>@kitten.jpg http://localhost:8080/files
</code></pre></div><p>where <code>kitten.jpg</code> is the path to the file that you want to upload.</p><p><code>curl</code> will form a <code>multipart/form-data</code> request with the filename, content type and file content to the <code>bee</code> API. Please see the <a href=https://ec.haxx.se/http/http-multipart>curl documentation</a> for more information on uploading multipart form-data with curl.</p><p>In case you&rsquo;d like to manually specify the content type during upload, you could do so using a query string parameter:</p><div class=highlight><pre class=chroma><code class=language-sh data-lang=sh>curl -H <span class=s2>&#34;Content-Type: image/x-jpeg&#34;</span> --data-binary @kitten.jpg localhost:8080/files?name<span class=o>=</span>cat.jpg
</code></pre></div><p>In both cases, the <code>bee/files</code> endpoint will return a <code>json</code> formatted response with a reference to the uploaded file, for example:</p><div class=highlight><pre class=chroma><code class=language-json data-lang=json><span class=p>{</span><span class=nt>&#34;reference&#34;</span><span class=p>:</span><span class=s2>&#34;3b2791985f102fe645d1ebd7f51e522d277098fcd86526674755f762084b94ee&#34;</span><span class=p>}</span>
</code></pre></div><p>The reference is the Swarm hash of the content which you just uploaded. Because of the properties of the <a href=https://en.wikipedia.org/wiki/Hash_function>hashing function</a>, it differs for each distinct file which you upload.</p><h2 id=download-via-command-line>Download via command-line</h2><p>Similarly to upload, we can use <code>curl</code> in the command-line to download a file. We make a GET request to the same <code>files</code> endpoint to download the file which we just uploaded:</p><div class=highlight><pre class=chroma><code class=language-sh data-lang=sh>curl http://localhost:8080/files/3b2791985f102fe645d1ebd7f51e522d277098fcd86526674755f762084b94ee
</code></pre></div><p>You will need to change the reference (the string after <code>/files/</code>) to the reference which you got while uploading the file.</p><p>Of course, you can use any command-line tool which makes HTTP-requests instead of <code>curl</code>.</p><h2 id=upload-via-browser>Upload via browser</h2><p>You can upload a file by using your browser. To do so, we will make use of a very simple upload form:</p><div class=highlight><pre class=chroma><code class=language-html data-lang=html><span class=p>&lt;</span><span class=nt>form</span> <span class=na>action</span><span class=o>=</span><span class=s>&#34;http://localhost:8080/files&#34;</span> <span class=na>method</span><span class=o>=</span><span class=s>&#34;post&#34;</span> <span class=na>enctype</span><span class=o>=</span><span class=s>&#34;multipart/form-data&#34;</span><span class=p>&gt;</span>
 <span class=p>&lt;</span><span class=nt>div</span><span class=p>&gt;</span>
   <span class=p>&lt;</span><span class=nt>input</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;file&#34;</span> <span class=na>name</span><span class=o>=</span><span class=s>&#34;file&#34;</span><span class=p>&gt;</span>
 <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
 <span class=p>&lt;</span><span class=nt>div</span><span class=p>&gt;</span>
   <span class=p>&lt;</span><span class=nt>button</span><span class=p>&gt;</span>Upload<span class=p>&lt;/</span><span class=nt>button</span><span class=p>&gt;</span>
 <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
<span class=p>&lt;/</span><span class=nt>form</span><span class=p>&gt;</span>
</code></pre></div><p>Copy this content and save it as an <code>.html</code> file on your computer (e.g. <code>upload.html</code>). Now, open the form which you just saved by navigating to your browser and pressing <code>CTRL +O</code> or via your filesystem and double-click on the <code>html</code>.</p><p>You can use this form to upload a file. Note that by for simplicity&rsquo;s sake, this form just makes a request to <code>localhost:8080</code>. If your node is running with a different <code>HTTP endpoint</code>, you must change the endpoint in the form too.</p><p>Note that a form, similar to this form is also served from our <a href=https://gateway.ethswarm.org/>public gateway</a>.</p><h2 id=download-via-browser>Download via browser</h2><p>Downloading a file via the browser is very simple.</p><p>Use your address-bar to navigate to <code>localhost:8080/files/{reference}</code>. Where <code>reference</code> is the address of your file, which was returned when you uploaded the file. The file should be opened in the browser, or you will get a prompt to save the file (depending on the file-type).</p><h1 id=starting-a-private-network>Starting a private network</h1><p>A private network can be started by overriding the default configuration values of your Swarm node. We will first talk about how to start a private network on your own computer and will speak afterwards about how you can invite your friends to join this network. Throughout this tutorial, we will make use of configuration files to configure the nodes, but of course you can do the same with flags or environment variables (see <a href=../bee-docs/start.html>Starting your node</a>).</p><h2 id=start-a-network-on-your-own-computer>Start a network on your own computer</h2><h3 id=configuration>Configuration</h3><p>Starting a network is easiest achieved by making use of configuration files. We need at least two nodes to start a network. Hence, below two configuration files are provided. Save them respectively as <code>config_1.yaml</code> and <code>config_2.yaml</code>.</p><p><strong>config_1.yaml</strong></p><div class=highlight><pre class=chroma><code class=language-yaml data-lang=yaml><span class=k>api-addr</span><span class=p>:</span><span class=w> </span><span class=p>:</span><span class=m>8080</span><span class=w>
</span><span class=w></span><span class=k>p2p-addr</span><span class=p>:</span><span class=w> </span><span class=p>:</span><span class=m>7070</span><span class=w>
</span><span class=w></span><span class=k>debug-api-addr</span><span class=p>:</span><span class=w> </span><span class=m>127.0.0.1</span><span class=p>:</span><span class=m>6060</span><span class=w>
</span><span class=w></span><span class=k>enable-debug-api</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span><span class=w></span><span class=k>data-dir</span><span class=p>:</span><span class=w> </span>/tmp/bee/node1<span class=w>
</span><span class=w></span><span class=k>password</span><span class=p>:</span><span class=w> </span>some<span class=w> </span>pass<span class=w> </span>phze<span class=w>
</span><span class=w></span><span class=k>verbosity</span><span class=p>:</span><span class=w> </span>trace<span class=w>
</span><span class=w></span><span class=k>bootnode</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;&#34;</span><span class=w>
</span><span class=w></span><span class=k>welcome-message</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;Bzz Bzz Bzz&#34;</span><span class=w>
</span></code></pre></div><p><strong>config_2.yaml</strong></p><div class=highlight><pre class=chroma><code class=language-yaml data-lang=yaml><span class=k>api-addr</span><span class=p>:</span><span class=w> </span><span class=p>:</span><span class=m>8081</span><span class=w>
</span><span class=w></span><span class=k>p2p-addr</span><span class=p>:</span><span class=w> </span><span class=p>:</span><span class=m>7071</span><span class=w>
</span><span class=w></span><span class=k>debug-api-addr</span><span class=p>:</span><span class=w> </span><span class=m>127.0.0.1</span><span class=p>:</span><span class=m>6061</span><span class=w>
</span><span class=w></span><span class=k>enable-debug-api</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span><span class=w></span><span class=k>data-dir</span><span class=p>:</span><span class=w> </span>/tmp/bee/node2<span class=w>
</span><span class=w></span><span class=k>password</span><span class=p>:</span><span class=w> </span>some<span class=w> </span>pass<span class=w> </span>phze<span class=w>
</span><span class=w></span><span class=k>verbosity</span><span class=p>:</span><span class=w> </span>trace<span class=w>
</span><span class=w></span><span class=k>tracing</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span><span class=w></span><span class=k>bootnode</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;&#34;</span><span class=w>
</span></code></pre></div><p>Note that for each node, we provide a different <code>api-addr</code>, <code>debug-api-addr</code>. If we would not specify different addresses here, we would get an <code>address already in use</code> error, as no two applications can listen to the same port. We also specify a different <code>p2p-addr</code>. If we would not do that, our nodes would not be able to communicate with each other. We won&rsquo;t get an error, however, as libp2p supports stream multiplexing. We also specify a seperate <code>data-dir</code> for each node. If we wouldn&rsquo;t specify this, the node would stop with an error <code>resource temporarily unavailable</code>, which is a protection from the database to prevent inconsistencies by multiple applications writing to the same database. Lastly, note the <code>welcome-message</code> for the first node. This is a small little feature, allowing you to set a message, printed to the console of the node which initiated a connection with you.</p><h3 id=starting>Starting</h3><p>Start your nodes by running <code>bee start --config config_1.yaml</code> and in another terminal <code>bee start --config-file config_2.yaml</code>.
You can expect the state of your network by calling <code>curl localhost:6060/topology | jq</code> and <code>curl localhost:6061/toplogy | jq</code>.</p><p>No connections? Right! Let&rsquo;s remedy that!</p><h3 id=making-a-network>Making a network</h3><p>In order to create a network, you must instruct your nodes to connect to each other. This step is not explicitely needed if you connect to the main Swarm network, as there are bootnodes into the Swarm network programmed by default.</p><p>To get the network address from the first node, we can call <code>curl localhost:6060/addresses | jq</code>. To get a list of all <a href=https://docs.libp2p.io/reference/glossary/#multiaddr>multiaddresses</a> on which you node can be reached.</p><p>Note down one of the addresses with an <code>ip4</code>, starting with 127.0.0.1 and past this full address into your config_2.yaml file. Now, shut down your second node and reboot again.</p><p>Did it connect? Verify this by looking at the console output of your first and second node and call again the <code>topology</code> endpoint.</p><h2 id=invite-friends-to-join-your-network>Invite friends to join your network</h2><p>Inviting friends to join your network is a breeze if your router or local network supports <a href=https://en.wikipedia.org/wiki/Universal_Plug_and_Play>UPNP</a>. You can verify this easiest by looking again at the output of <code>localhost:6060/addresses</code>. Does it list your external IP? If yes, you can just tell your friends to set this IP as their bootnode configuration. If not, now it can become a bit difficult. Most likely, you need to switch on your UPNP, but there may be other factors involved too. Please reach out to us in <a href=beehive.ethswarm.org>the Beehive</a> or with a <a href=https://github.com/ethersphere/bee/issues/new/choose>Github issue</a> if you encounter problems in forming a network!</p></div></div></div></div></div></div><div class=sub-footer><div class=container><div class=row><div class=col-12><div class=sub-footer-inner><ul><li class=zerostatic><a href=https://swarm-gateways.net/bzz:/docs.swarm.eth/>docs.swarm.eth</a></li></ul></div></div></div></div></div><script type=text/javascript src=../js/scripts.min.1237ff71925bb8625c97a9af8db4c54525258bedfd7c47493daaff723bea755e.js></script></body></html>